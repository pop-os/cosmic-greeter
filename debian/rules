#!/usr/bin/make -f

export DESTDIR = debian/tmp
export VENDOR ?= 1

%:
	dh $@

override_dh_auto_clean:
	if ! ischroot && test "${VENDOR}" = "1"; then \
		mkdir -p .cargo; \
		cargo vendor | head -n -1 > .cargo/config.toml; \
		echo 'directory = "vendor"' >> .cargo/config.toml; \
		tar pcf vendor.tar vendor; \
		rm -rf vendor; \
	fi

override_dh_auto_build:
	just build-vendored

override_dh_auto_install:
	just rootdir=$(DESTDIR) install-debian

execute_after_dh_install:
	dh_installsysusers

override_dh_installsystemd:
	dh_installsystemd -pcosmic-greeter --no-start -r cosmic-greeter.service
	dh_installsystemd -pcosmic-greeter-daemon cosmic-greeter-daemon.service

